<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡ä»¶åŠŸèƒ½æµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    
    .test-section {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .test-section h2 {
      color: #555;
      margin-bottom: 15px;
      font-size: 18px;
      border-bottom: 2px solid #007bff;
      padding-bottom: 8px;
    }
    
    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    
    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #0056b3;
    }
    
    button.secondary {
      background: #6c757d;
    }
    
    button.secondary:hover {
      background: #545b62;
    }
    
    button.danger {
      background: #dc3545;
    }
    
    button.danger:hover {
      background: #c82333;
    }
    
    button.success {
      background: #28a745;
    }
    
    button.success:hover {
      background: #218838;
    }
    
    .file-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .file-card {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 15px;
      transition: all 0.2s;
    }
    
    .file-card:hover {
      border-color: #007bff;
      box-shadow: 0 2px 8px rgba(0,123,255,0.2);
    }
    
    .file-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .file-icon {
      font-size: 32px;
    }
    
    .file-name {
      font-weight: 600;
      color: #333;
      font-size: 14px;
      word-break: break-word;
    }
    
    .file-meta {
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 10px;
    }
    
    .file-actions {
      display: flex;
      gap: 5px;
    }
    
    .file-actions button {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    
    .log-area {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }
    
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid #007bff;
      background: white;
    }
    
    .log-entry.success {
      border-left-color: #28a745;
    }
    
    .log-entry.warning {
      border-left-color: #ffc107;
    }
    
    .log-entry.error {
      border-left-color: #dc3545;
    }
    
    input[type="text"] {
      padding: 8px 12px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      font-size: 14px;
      width: 300px;
    }
    
    .search-bar {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ æ–‡ä»¶ç®¡ç†åŠŸèƒ½æµ‹è¯•</h1>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="test-section">
      <h2>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h2>
      <div class="stats-grid" id="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-files">0</div>
          <div class="stat-label">æ€»æ–‡ä»¶æ•°</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
          <div class="stat-value" id="total-size">0</div>
          <div class="stat-label">æ€»å¤§å° (MB)</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <div class="stat-value" id="csv-count">0</div>
          <div class="stat-label">CSV æ–‡ä»¶</div>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          <div class="stat-value" id="html-count">0</div>
          <div class="stat-label">HTML æ–‡ä»¶</div>
        </div>
      </div>
    </div>
    
    <!-- æ–‡ä»¶ç”Ÿæˆ -->
    <div class="test-section">
      <h2>â• ç”Ÿæˆæµ‹è¯•æ–‡ä»¶</h2>
      <div class="button-group">
        <button onclick="generateSampleCSV()">ç”Ÿæˆç¤ºä¾‹ CSV</button>
        <button onclick="generateLargeCSV()">ç”Ÿæˆå¤§å‹ CSV (100è¡Œ)</button>
        <button onclick="generateSampleHTML()">ç”Ÿæˆç¤ºä¾‹ HTML</button>
        <button onclick="generateMultipleFiles()">æ‰¹é‡ç”Ÿæˆ (5ä¸ªæ–‡ä»¶)</button>
      </div>
    </div>
    
    <!-- æœç´¢å’Œè¿‡æ»¤ -->
    <div class="test-section">
      <h2>ğŸ” æœç´¢å’Œè¿‡æ»¤</h2>
      <div class="search-bar">
        <input type="text" id="search-input" placeholder="æœç´¢æ–‡ä»¶å..." oninput="searchFiles()">
        <button onclick="filterByType('all')">å…¨éƒ¨</button>
        <button onclick="filterByType('csv')">CSV</button>
        <button onclick="filterByType('html')">HTML</button>
        <button class="secondary" onclick="clearSearch()">æ¸…é™¤</button>
      </div>
    </div>
    
    <!-- æ–‡ä»¶åˆ—è¡¨ -->
    <div class="test-section">
      <h2>ğŸ“„ æ–‡ä»¶åˆ—è¡¨</h2>
      <div class="button-group">
        <button class="success" onclick="refreshFileList()">åˆ·æ–°åˆ—è¡¨</button>
        <button class="danger" onclick="clearAllFiles()">æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶</button>
      </div>
      <div class="file-grid" id="file-grid"></div>
    </div>
    
    <!-- æ—¥å¿— -->
    <div class="test-section">
      <h2>ğŸ“ æ“ä½œæ—¥å¿—</h2>
      <button class="secondary" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
      <div class="log-area" id="log-area"></div>
    </div>
  </div>

  <script src="document-generator.js"></script>
  <script src="file-manager.js"></script>
  <script>
    const fileManager = new FileManager();
    fileManager.loadFromStorage();
    const documentGenerator = new DocumentGenerator();
    
    let currentFilter = 'all';
    let currentSearch = '';

    // æ·»åŠ æ—¥å¿—
    function addLog(message, type = 'info') {
      const logArea = document.getElementById('log-area');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      const time = new Date().toLocaleTimeString('zh-CN');
      entry.innerHTML = `<strong>[${time}]</strong> ${message}`;
      logArea.appendChild(entry);
      logArea.scrollTop = logArea.scrollHeight;
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats() {
      const stats = fileManager.getStats();
      document.getElementById('total-files').textContent = stats.totalFiles;
      document.getElementById('total-size').textContent = (stats.totalSize / (1024 * 1024)).toFixed(2);
      document.getElementById('csv-count').textContent = stats.byType.csv?.count || 0;
      document.getElementById('html-count').textContent = stats.byType.html?.count || 0;
    }

    // ç”Ÿæˆç¤ºä¾‹ CSV
    async function generateSampleCSV() {
      try {
        addLog('ç”Ÿæˆç¤ºä¾‹ CSV æ–‡ä»¶...', 'info');
        const data = [
          ['å§“å', 'å¹´é¾„', 'åŸå¸‚', 'èŒä¸š'],
          ['å¼ ä¸‰', '25', 'åŒ—äº¬', 'å·¥ç¨‹å¸ˆ'],
          ['æå››', '30', 'ä¸Šæµ·', 'è®¾è®¡å¸ˆ'],
          ['ç‹äº”', '28', 'å¹¿å·', 'äº§å“ç»ç†']
        ];
        
        const blob = await documentGenerator.generateExcel(data, 'sample.csv');
        fileManager.addFile({
          name: 'sample.csv',
          type: 'csv',
          data: data,
          blob: blob,
          size: blob.size
        });
        
        addLog('ç¤ºä¾‹ CSV æ–‡ä»¶ç”ŸæˆæˆåŠŸ', 'success');
        refreshFileList();
      } catch (error) {
        addLog(`ç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
      }
    }

    // ç”Ÿæˆå¤§å‹ CSV
    async function generateLargeCSV() {
      try {
        addLog('ç”Ÿæˆå¤§å‹ CSV æ–‡ä»¶ (100è¡Œ)...', 'info');
        const data = [['ID', 'å§“å', 'é‚®ç®±', 'ç”µè¯', 'åœ°å€']];
        
        for (let i = 1; i <= 100; i++) {
          data.push([
            i,
            `ç”¨æˆ·${i}`,
            `user${i}@example.com`,
            `138${String(i).padStart(8, '0')}`,
            `åœ°å€${i}`
          ]);
        }
        
        const blob = await documentGenerator.generateExcel(data, 'large_data.csv');
        fileManager.addFile({
          name: 'large_data.csv',
          type: 'csv',
          data: data,
          blob: blob,
          size: blob.size
        });
        
        addLog('å¤§å‹ CSV æ–‡ä»¶ç”ŸæˆæˆåŠŸ', 'success');
        refreshFileList();
      } catch (error) {
        addLog(`ç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
      }
    }

    // ç”Ÿæˆç¤ºä¾‹ HTML
    async function generateSampleHTML() {
      try {
        addLog('ç”Ÿæˆç¤ºä¾‹ HTML æ–‡ä»¶...', 'info');
        const content = {
          title: 'æµ‹è¯•æ–‡æ¡£',
          paragraphs: [
            'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æ¡£çš„ç¬¬ä¸€æ®µå†…å®¹ã€‚',
            'è¿™æ˜¯ç¬¬äºŒæ®µå†…å®¹ï¼ŒåŒ…å«ä¸€äº›ç¤ºä¾‹æ–‡æœ¬ã€‚'
          ],
          tables: [[
            ['é¡¹ç›®', 'æ•°é‡', 'å•ä»·'],
            ['äº§å“A', '10', '100'],
            ['äº§å“B', '20', '200']
          ]]
        };
        
        const blob = await documentGenerator.generateWord(content, 'sample.html');
        fileManager.addFile({
          name: 'sample.html',
          type: 'html',
          data: content,
          blob: blob,
          size: blob.size
        });
        
        addLog('ç¤ºä¾‹ HTML æ–‡ä»¶ç”ŸæˆæˆåŠŸ', 'success');
        refreshFileList();
      } catch (error) {
        addLog(`ç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
      }
    }

    // æ‰¹é‡ç”Ÿæˆæ–‡ä»¶
    async function generateMultipleFiles() {
      try {
        addLog('æ‰¹é‡ç”Ÿæˆ 5 ä¸ªæ–‡ä»¶...', 'info');
        
        for (let i = 1; i <= 5; i++) {
          const data = [
            ['åˆ—1', 'åˆ—2', 'åˆ—3'],
            [`æ•°æ®${i}-1`, `æ•°æ®${i}-2`, `æ•°æ®${i}-3`]
          ];
          
          const blob = await documentGenerator.generateExcel(data, `batch_${i}.csv`);
          fileManager.addFile({
            name: `batch_${i}.csv`,
            type: 'csv',
            data: data,
            blob: blob,
            size: blob.size
          });
        }
        
        addLog('æ‰¹é‡ç”Ÿæˆå®Œæˆ', 'success');
        refreshFileList();
      } catch (error) {
        addLog(`æ‰¹é‡ç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
      }
    }

    // æœç´¢æ–‡ä»¶
    function searchFiles() {
      currentSearch = document.getElementById('search-input').value;
      refreshFileList();
    }

    // æŒ‰ç±»å‹è¿‡æ»¤
    function filterByType(type) {
      currentFilter = type;
      refreshFileList();
    }

    // æ¸…é™¤æœç´¢
    function clearSearch() {
      document.getElementById('search-input').value = '';
      currentSearch = '';
      currentFilter = 'all';
      refreshFileList();
    }

    // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
    function refreshFileList() {
      let files = fileManager.getFiles();
      
      // åº”ç”¨æœç´¢
      if (currentSearch) {
        files = fileManager.searchFiles(currentSearch);
      }
      
      // åº”ç”¨è¿‡æ»¤
      if (currentFilter !== 'all') {
        files = files.filter(f => f.type === currentFilter);
      }
      
      const grid = document.getElementById('file-grid');
      
      if (files.length === 0) {
        grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #6c757d;">æš‚æ— æ–‡ä»¶</p>';
      } else {
        grid.innerHTML = '';
        files.forEach(file => {
          const card = createFileCard(file);
          grid.appendChild(card);
        });
      }
      
      updateStats();
      addLog(`æ–‡ä»¶åˆ—è¡¨å·²åˆ·æ–°ï¼Œæ˜¾ç¤º ${files.length} ä¸ªæ–‡ä»¶`, 'info');
    }

    // åˆ›å»ºæ–‡ä»¶å¡ç‰‡
    function createFileCard(file) {
      const card = document.createElement('div');
      card.className = 'file-card';
      
      const icon = file.type === 'csv' ? 'ğŸ“Š' : 'ğŸ“„';
      const date = new Date(file.createdAt).toLocaleString('zh-CN');
      const sizeKB = (file.size / 1024).toFixed(2);
      
      card.innerHTML = `
        <div class="file-card-header">
          <div class="file-icon">${icon}</div>
          <div class="file-name">${file.name}</div>
        </div>
        <div class="file-meta">
          ${date}<br>
          ${sizeKB} KB
        </div>
        <div class="file-actions">
          <button onclick="downloadFile('${file.id}')">ä¸‹è½½</button>
          <button onclick="duplicateFile('${file.id}')">å¤åˆ¶</button>
          <button onclick="renameFile('${file.id}')">é‡å‘½å</button>
          <button class="danger" onclick="deleteFile('${file.id}')">åˆ é™¤</button>
        </div>
      `;
      
      return card;
    }

    // ä¸‹è½½æ–‡ä»¶
    function downloadFile(fileId) {
      fileManager.downloadFile(fileId);
      const file = fileManager.getFile(fileId);
      addLog(`æ–‡ä»¶å·²ä¸‹è½½: ${file.name}`, 'success');
    }

    // å¤åˆ¶æ–‡ä»¶
    function duplicateFile(fileId) {
      const newFileId = fileManager.duplicateFile(fileId);
      const file = fileManager.getFile(newFileId);
      addLog(`æ–‡ä»¶å·²å¤åˆ¶: ${file.name}`, 'success');
      refreshFileList();
    }

    // é‡å‘½åæ–‡ä»¶
    function renameFile(fileId) {
      const file = fileManager.getFile(fileId);
      const newName = prompt('è¯·è¾“å…¥æ–°çš„æ–‡ä»¶å:', file.name);
      
      if (newName && newName.trim() && newName !== file.name) {
        if (fileManager.renameFile(fileId, newName)) {
          addLog(`æ–‡ä»¶å·²é‡å‘½å: ${file.name} â†’ ${newName}`, 'success');
          refreshFileList();
        }
      }
    }

    // åˆ é™¤æ–‡ä»¶
    function deleteFile(fileId) {
      const file = fileManager.getFile(fileId);
      if (confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${file.name}" å—ï¼Ÿ`)) {
        fileManager.deleteFile(fileId);
        addLog(`æ–‡ä»¶å·²åˆ é™¤: ${file.name}`, 'warning');
        refreshFileList();
      }
    }

    // æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶
    function clearAllFiles() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼')) {
        fileManager.clearAll();
        addLog('æ‰€æœ‰æ–‡ä»¶å·²æ¸…ç©º', 'warning');
        refreshFileList();
      }
    }

    // æ¸…ç©ºæ—¥å¿—
    function clearLogs() {
      document.getElementById('log-area').innerHTML = '';
      addLog('æ—¥å¿—å·²æ¸…ç©º', 'info');
    }

    // åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', () => {
      addLog('é¡µé¢åŠ è½½å®Œæˆ', 'info');
      refreshFileList();
    });
  </script>
</body>
</html>
