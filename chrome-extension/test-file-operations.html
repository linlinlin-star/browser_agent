<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡ä»¶æ“ä½œæµ‹è¯•</title>
  <link rel="stylesheet" href="popup.css">
  <link rel="stylesheet" href="chat.css">
  <style>
    body {
      padding: 20px;
      background: #f5f5f5;
    }
    
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .test-header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .test-header h1 {
      margin: 0 0 10px 0;
      color: #333;
    }
    
    .test-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    
    .test-btn {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .test-btn:hover {
      background: #0056b3;
    }
    
    .test-btn.secondary {
      background: #6c757d;
    }
    
    .test-btn.danger {
      background: #dc3545;
    }
    
    .console-panel {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>ğŸ“ æ–‡ä»¶æ“ä½œåŠŸèƒ½æµ‹è¯•</h1>
      <p>æµ‹è¯•æ–‡ä»¶çš„é¢„è§ˆã€ç¼–è¾‘ã€å¤åˆ¶å’Œåˆ é™¤åŠŸèƒ½</p>
      
      <div class="test-actions">
        <button class="test-btn" onclick="generateTestCSV()">ç”Ÿæˆæµ‹è¯• CSV</button>
        <button class="test-btn" onclick="generateTestHTML()">ç”Ÿæˆæµ‹è¯• HTML</button>
        <button class="test-btn" onclick="generateMultiple()">ç”Ÿæˆå¤šä¸ªæ–‡ä»¶</button>
        <button class="test-btn secondary" onclick="testAllFunctions()">æµ‹è¯•æ‰€æœ‰åŠŸèƒ½</button>
        <button class="test-btn danger" onclick="clearAll()">æ¸…ç©ºæ‰€æœ‰</button>
      </div>
    </div>
    
    <div class="console-panel">
      <div class="console-header">
        <h2>æ–‡ä»¶ç®¡ç†</h2>
      </div>
      
      <div class="console-tabs">
        <button class="console-tab" data-tab="session">Current Session</button>
        <button class="console-tab active" data-tab="files">Files</button>
      </div>
      
      <div class="console-content" id="console-content">
        <div class="console-empty">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          <span>æš‚æ— ç”Ÿæˆçš„æ–‡ä»¶</span>
        </div>
      </div>
    </div>
  </div>

  <script src="document-generator.js"></script>
  <script src="file-manager.js"></script>
  <script src="popup.js"></script>
  
  <script>
    // ç”Ÿæˆæµ‹è¯• CSV
    async function generateTestCSV() {
      try {
        console.log('[TEST] ç”Ÿæˆæµ‹è¯• CSV...');
        const data = [
          ['å§“å', 'å¹´é¾„', 'åŸå¸‚', 'èŒä¸š'],
          ['å¼ ä¸‰', '25', 'åŒ—äº¬', 'å·¥ç¨‹å¸ˆ'],
          ['æå››', '30', 'ä¸Šæµ·', 'è®¾è®¡å¸ˆ'],
          ['ç‹äº”', '28', 'å¹¿å·', 'äº§å“ç»ç†'],
          ['èµµå…­', '32', 'æ·±åœ³', 'é¡¹ç›®ç»ç†']
        ];
        
        const generator = new DocumentGenerator();
        const blob = await generator.generateExcel(data, 'test_data.csv');
        
        fileManager.addFile({
          name: 'test_data.csv',
          type: 'csv',
          data: data,
          blob: blob,
          size: blob.size
        });
        
        console.log('[TEST] CSV æ–‡ä»¶ç”ŸæˆæˆåŠŸ');
        renderFileList();
        alert('âœ… CSV æ–‡ä»¶ç”ŸæˆæˆåŠŸï¼\n\nè¯·ç‚¹å‡»é¢„è§ˆæŒ‰é’®æµ‹è¯•é¢„è§ˆåŠŸèƒ½ã€‚');
      } catch (error) {
        console.error('[TEST] ç”Ÿæˆå¤±è´¥:', error);
        alert('âŒ ç”Ÿæˆå¤±è´¥: ' + error.message);
      }
    }
    
    // ç”Ÿæˆæµ‹è¯• HTML
    async function generateTestHTML() {
      try {
        console.log('[TEST] ç”Ÿæˆæµ‹è¯• HTML...');
        const content = {
          title: 'æµ‹è¯•æ–‡æ¡£',
          paragraphs: [
            'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡æ¡£çš„ç¬¬ä¸€æ®µå†…å®¹ã€‚',
            'è¿™æ˜¯ç¬¬äºŒæ®µå†…å®¹ï¼Œç”¨äºæµ‹è¯• HTML é¢„è§ˆåŠŸèƒ½ã€‚',
            'ç¬¬ä¸‰æ®µåŒ…å«ä¸€äº›ç¤ºä¾‹æ–‡æœ¬ã€‚'
          ],
          tables: [[
            ['é¡¹ç›®', 'æ•°é‡', 'å•ä»·', 'æ€»ä»·'],
            ['äº§å“A', '10', '100', '1000'],
            ['äº§å“B', '20', '200', '4000'],
            ['äº§å“C', '15', '150', '2250']
          ]]
        };
        
        const generator = new DocumentGenerator();
        const blob = await generator.generateWord(content, 'test_document.html');
        
        fileManager.addFile({
          name: 'test_document.html',
          type: 'html',
          data: content,
          blob: blob,
          size: blob.size
        });
        
        console.log('[TEST] HTML æ–‡ä»¶ç”ŸæˆæˆåŠŸ');
        renderFileList();
        alert('âœ… HTML æ–‡ä»¶ç”ŸæˆæˆåŠŸï¼\n\nè¯·ç‚¹å‡»é¢„è§ˆæŒ‰é’®æµ‹è¯•é¢„è§ˆåŠŸèƒ½ã€‚');
      } catch (error) {
        console.error('[TEST] ç”Ÿæˆå¤±è´¥:', error);
        alert('âŒ ç”Ÿæˆå¤±è´¥: ' + error.message);
      }
    }
    
    // ç”Ÿæˆå¤šä¸ªæ–‡ä»¶
    async function generateMultiple() {
      try {
        console.log('[TEST] æ‰¹é‡ç”Ÿæˆæ–‡ä»¶...');
        const generator = new DocumentGenerator();
        
        for (let i = 1; i <= 5; i++) {
          const data = [
            ['ID', 'åç§°', 'å€¼'],
            [i, `é¡¹ç›®${i}`, `æ•°æ®${i}`]
          ];
          
          const blob = await generator.generateExcel(data, `batch_${i}.csv`);
          
          fileManager.addFile({
            name: `batch_${i}.csv`,
            type: 'csv',
            data: data,
            blob: blob,
            size: blob.size
          });
        }
        
        console.log('[TEST] æ‰¹é‡ç”Ÿæˆå®Œæˆ');
        renderFileList();
        alert('âœ… æ‰¹é‡ç”Ÿæˆå®Œæˆï¼\n\nç”Ÿæˆäº† 5 ä¸ªæ–‡ä»¶ï¼Œè¯·æµ‹è¯•å„ç§æ“ä½œã€‚');
      } catch (error) {
        console.error('[TEST] æ‰¹é‡ç”Ÿæˆå¤±è´¥:', error);
        alert('âŒ æ‰¹é‡ç”Ÿæˆå¤±è´¥: ' + error.message);
      }
    }
    
    // æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
    function testAllFunctions() {
      const tests = [
        'âœ… é¢„è§ˆåŠŸèƒ½: ç‚¹å‡»æ–‡ä»¶çš„"é¢„è§ˆ"æŒ‰é’®',
        'âœ… ç¼–è¾‘åŠŸèƒ½: åœ¨é¢„è§ˆé¡µé¢ç¼–è¾‘å•å…ƒæ ¼ï¼Œç‚¹å‡»"ä¿å­˜æ›´æ”¹"',
        'âœ… æ·»åŠ è¡Œ: åœ¨ CSV é¢„è§ˆé¡µé¢ç‚¹å‡»"æ·»åŠ è¡Œ"æŒ‰é’®',
        'âœ… åˆ é™¤è¡Œ: ç‚¹å‡»è¡Œæœ«çš„åˆ é™¤æŒ‰é’®',
        'âœ… é‡å‘½å: åœ¨é¢„è§ˆé¡µé¢ç‚¹å‡»æ–‡ä»¶åæ—çš„é‡å‘½åæŒ‰é’®',
        'âœ… å¤åˆ¶åŠŸèƒ½: ç‚¹å‡»æ–‡ä»¶çš„"å¤åˆ¶"æŒ‰é’®',
        'âœ… ä¸‹è½½åŠŸèƒ½: ç‚¹å‡»æ–‡ä»¶çš„"ä¸‹è½½"æŒ‰é’®',
        'âœ… åˆ é™¤åŠŸèƒ½: ç‚¹å‡»æ–‡ä»¶çš„"åˆ é™¤"æŒ‰é’®',
        'âœ… æœç´¢åŠŸèƒ½: åœ¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯',
        'âœ… è¿‡æ»¤åŠŸèƒ½: ç‚¹å‡»"CSV"æˆ–"HTML"è¿‡æ»¤æŒ‰é’®'
      ];
      
      alert('ğŸ“‹ åŠŸèƒ½æµ‹è¯•æ¸…å•ï¼š\n\n' + tests.join('\n'));
    }
    
    // æ¸…ç©ºæ‰€æœ‰
    function clearAll() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶å—ï¼Ÿ')) {
        fileManager.clearAll();
        renderFileList();
        console.log('[TEST] æ‰€æœ‰æ–‡ä»¶å·²æ¸…ç©º');
        alert('âœ… æ‰€æœ‰æ–‡ä»¶å·²æ¸…ç©º');
      }
    }
    
    // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
    window.addEventListener('DOMContentLoaded', () => {
      console.log('[TEST] é¡µé¢åŠ è½½å®Œæˆ');
      console.log('[TEST] fileManager:', fileManager);
      console.log('[TEST] previewFile:', typeof window.previewFile);
      console.log('[TEST] duplicateFileById:', typeof window.duplicateFileById);
      console.log('[TEST] downloadFileById:', typeof window.downloadFileById);
      console.log('[TEST] deleteFileById:', typeof window.deleteFileById);
      
      renderFileList();
    });
  </script>
</body>
</html>
